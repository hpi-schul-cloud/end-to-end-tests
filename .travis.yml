language: node_js
node_js: '10'
sudo: required
branches:
  only:
    - develop
    - master
    - /^(?i:release|hotfix|master_).*$/
env:
  global:
    - GIT_SHA=$( git rev-parse HEAD )
    - BRANCH_NAME=${TRAVIS_PULL_REQUEST_BRANCH:=$TRAVIS_BRANCH}
jobs:
  include:
    - stage: run parallel
      name: test:end-to-end
      script:
        - echo $TRAVIS_BRANCH
        - echo $TRAVIS_TAG
        - curl "https://raw.githubusercontent.com/hpi-schul-cloud/end-to-end-tests/master/scripts/ci/fetch.travis.sh" | bash
      name: "test:end-to-end"
      env:
        - IT_CLIENT_HOST=nuxtclient
        - IT_CLIENT_PORT=4000
      git:
        clone: false
      services:
        - docker
      before_install:
        - echo -e "machine github.com\n  login $CI_USER_TOKEN" > ~/.netrc
      install:
        - echo "skipping install"
      before_cache:
        - mkdir -p node_modules
      after_failure:
        - cat /home/travis/.npm/_logs/*debug.log
cache:
  directories:
    - "$HOME/.npm" # cache all packages installed with "npm ci"
